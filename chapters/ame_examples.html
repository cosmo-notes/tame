
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Approximate Master Equations &#8212; TAME</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/ame_examples';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mean-field limits to approximate master equations" href="meanFLAME.html" />
    <link rel="prev" title="Lotka-Volterra predator-prey model" href="lotka_volterra.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="TAME - Home"/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt="TAME - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Master Equations 101</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="me_properties.html">Definition and properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="numerical_integration.html">Numerical integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="moment_method.html">Method of Moments</a></li>
<li class="toctree-l1"><a class="reference internal" href="pgf_solution.html">Explicit solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="detailed_balance.html">Detailed balance</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lotka_volterra.html">Predator-prey</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Approximate master equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="meanFLAME.html">Mean-field limits to approximate master equations</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exercises</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="exercise_SIS.html">Part I: SIS dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercise_enzyme.html">Part II: Enzymes</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercise_game.html">Part III: Game theory</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/cosmos-books/tame/main?urlpath=lab/tree/chapters/ame_examples.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/cosmos-books/tame" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapters/ame_examples.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Approximate Master Equations</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ames-for-networks">AMEs for networks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logic-of-node-based-ames">Logic of node-based AMEs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-of-node-based-ames">Implementation of node-based AMEs</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="approximate-master-equations">
<h1>Approximate Master Equations<a class="headerlink" href="#approximate-master-equations" title="Link to this heading">#</a></h1>
<p><strong>Âmes</strong> is French for souls. <strong>AMEs</strong>, the acronym for approximate master equations, are almost as powerful and magical.</p>
<p>The biggest issue with master equations is that they scale directly with the number of states available to the system. Complex systems are generally made of large systems of <span class="math notranslate nohighlight">\(N\)</span> interacting parts. Even in simple binary dynamics, this would imply <span class="math notranslate nohighlight">\(2^N\)</span> possible states for the system. In order to use master equations to model real complex systems, we will need to break down these systems in subsystems and coarse-grain the systems of master equations. Of course, doing so means our approach won’t be exact and won’t fully describe the system, but it is still powerful. We call this approach <strong>Approximate Master Equations</strong>.</p>
<p>We illustrate AMEs with a few examples below.</p>
<section id="ames-for-networks">
<h2>AMEs for networks<a class="headerlink" href="#ames-for-networks" title="Link to this heading">#</a></h2>
<p>We will quickly cover two general approaches to AMEs on networks:</p>
<ul class="simple">
<li><p>Node-based AMEs which compress networks based on the state of nodes and of their neighbors, introduced in <strong><em>Adaptive networks: Coevolution of disease and topology</em></strong> <span id="id1">[<a class="reference internal" href="index.html#id7" title="Vincent Marceau, Pierre-André Noël, Laurent Hébert-Dufresne, Antoine Allard, and Louis J Dubé. Adaptive networks: coevolution of disease and topology. Physical Review E, 82(3):036116, 2010.">Marceau <em>et al.</em>, 2010</a>]</span></p></li>
<li><p>Group-based AMEs which compress networks based on the states of nodes within cliques or groups, introduced <strong><em>Propagation dynamics on networks featuring complex topologies</em></strong> <span id="id2">[<a class="reference internal" href="index.html#id6" title="Laurent Hébert-Dufresne, Pierre-André Noël, Vincent Marceau, Antoine Allard, and Louis J Dubé. Propagation dynamics on networks featuring complex topologies. Physical Review E, 82(3):036115, 2010.">Hébert-Dufresne <em>et al.</em>, 2010</a>]</span>. Some say that the approach is better described in <strong><em>Master equation analysis of mesoscopic localization in contagion dynamics on higher-order networks</em></strong> <span id="id3">[<a class="reference internal" href="index.html#id8" title="Guillaume St-Onge, Vincent Thibeault, Antoine Allard, Louis J Dubé, and Laurent Hébert-Dufresne. Master equation analysis of mesoscopic localization in contagion dynamics on higher-order networks. Physical Review E, 103(3):032301, 2021.">St-Onge <em>et al.</em>, 2021</a>]</span>.</p></li>
</ul>
<p>The two approaches are summarized on the figure below using a simple network where nodes are either blue or red and groups either triangle or simple links.</p>
<p><img alt="ame_schematic" src="../_images/ames.png" /></p>
<p>The node-based approach breaks down a network based on the states available for nodes and the <span class="math notranslate nohighlight">\(k+1\)</span> states available to their neighborhood of <span class="math notranslate nohighlight">\(k\)</span> neighbors. For example, in binary dynamics, a node of degree 2 can have 3 possible neighborhoods: 2 red nodes, 2 blue nodes, or 1 of each. We can thus write master equations covering all possible states for star-motifs, with a different set of master equations for every degree class in the network. In our example above, the node-based approach is summarized in the top right corner of the cartoon, and would require 24 equations to fully describe. That’s 14 for the hub of degree 6 (7 per state of the hub), 6 for the nodes of degree 2, and 4 for the leaves of degree 1.</p>
<p>The group-based approach breaks down a network based on well-defined groups like fully connected cliques and on the states of nodes they contain. For example, the network above contains cliques of size two (edges) and three (triangles). In binary dynamics, a clique of size <span class="math notranslate nohighlight">\(n\)</span> can be in <span class="math notranslate nohighlight">\(n+1\)</span> states. To couple them, the group-based approach also tracks nodes based on their state and the number of groups they belong to. The entire approach is summarized in the bottom corner of the cartoon. So, this simple example would require 7 group equations and 4 member equations to describe with group-based AMEs; 11 equations total.</p>
</section>
<section id="logic-of-node-based-ames">
<h2>Logic of node-based AMEs<a class="headerlink" href="#logic-of-node-based-ames" title="Link to this heading">#</a></h2>
<p>Say that we are interested in the SIS dynamics (or any other binary state model) on a network composed of <span class="math notranslate nohighlight">\(N\)</span> nodes and <span class="math notranslate nohighlight">\(M\)</span> edges. We then decompose the network into a set of <span class="math notranslate nohighlight">\(N\)</span> node-based motifs, each composed of a central root node and its <span class="math notranslate nohighlight">\(k\)</span> neighbors. A node of degree <span class="math notranslate nohighlight">\(k\)</span> is therefore involved in one motif where it acts as a root and in <span class="math notranslate nohighlight">\(k\)</span> motifs where it acts as a leaf. We describe the local dynamics of these motifs exactly, which involves tracking the recovery of infected nodes, the infection of leaves by the root, or vice versa. Moreover, the leaves can also be infected by their <em>other</em> neighbors, which we will assume to be random such that motifs are connected through a mean-field quantity. This is the <em>approximation</em> in approximate master equations.</p>
<p>To track the exact state of any motif, these master equations require two degrees of freedom. One tracks the state of the root node, either susceptible denoted <span class="math notranslate nohighlight">\(S\)</span> or infectious denoted <span class="math notranslate nohighlight">\(I\)</span>. The other requires the degree <span class="math notranslate nohighlight">\(k\)</span> of the root node, i.e., the number of leaves, and then tracks how many neighbors <span class="math notranslate nohighlight">\(\ell\)</span> are infectious. We then track the probability mass of this motif using an approximate master equation over the occupation numbers <span class="math notranslate nohighlight">\(S_{k,\ell}\)</span> and <span class="math notranslate nohighlight">\(I_{k,\ell}\)</span>.</p>
<p>We have <span class="math notranslate nohighlight">\(S_{k,\ell}(t)\)</span> and <span class="math notranslate nohighlight">\(I_{k,\ell}(t)\)</span>, the fractions of nodes that are respectively susceptible and infectious and that have total degree <span class="math notranslate nohighlight">\(k\)</span> with <span class="math notranslate nohighlight">\(\ell\)</span> infectious neighbours at time <span class="math notranslate nohighlight">\(t\)</span>. From there, the dynamics within the motif will follow standard master equations procedures with transitions related to the recovery of the root or neighbours and to the infection of the root or neighbours. The trickier part is to approximately capture the coupling between motifs. And for that, we define some important quantities.</p>
<p>The zero-th order moment of the <span class="math notranslate nohighlight">\(S_{k,\ell}\)</span> and <span class="math notranslate nohighlight">\(I_{k,\ell}\)</span> distributions gives us the fraction of susceptible and infectious nodes in the network at time <span class="math notranslate nohighlight">\(t\)</span>:</p>
<div class="math notranslate nohighlight">
\[
S = \sum_{k,\ell} S_{k,\ell} \quad \textrm{and} \quad I = \sum_{k,\ell} I_{k,\ell} \; .
\]</div>
<p>The first order moments give us, for example, the expected number of susceptible/infectious neighbours of susceptible nodes, respectively <span class="math notranslate nohighlight">\(S_S\)</span> and <span class="math notranslate nohighlight">\(S_I\)</span> tagged by the state of the root node first:</p>
<div class="math notranslate nohighlight">
\[
S_S = \sum_{k,\ell} (k-\ell)S_{k,\ell} \quad \textrm{and} \quad S_I = \sum_{k,\ell} \ell S_{k,\ell} \; .
\]</div>
<p>And the second order moments can give us, for example, the number of arcs (or paths of length two) in the networks that are rooted on susceptible nodes and connect a susceptible/infectious node to an infectious nodes:</p>
<div class="math notranslate nohighlight">
\[
S_{SI} = \sum_{k,\ell} (k-\ell)\ell S_{k,\ell} \quad \textrm{and} \quad S_{II} = \sum_{k,\ell} \ell(\ell-1) S_{k,\ell} \; .
\]</div>
<p>With these quantities, we can derive the mean-field coupling between motifs. For example, a susceptible neighbour of a susceptible node will be in contact with an expected number of infectious neighbours equal to:</p>
<div class="math notranslate nohighlight">
\[
\theta_1 = \frac{S_{SI}}{S_S}
\]</div>
<p>as that quantities is equal to the expected number of paths over three nodes that go “susceptible” to “susceptible” to “infectious”, for every path that “susceptible” to “susceptible”. Likewise, we can calculate the expected number of paths over three nodes that go “infectious” to “susceptible” to “infectious”, for every path that “infectious” to “susceptible”:</p>
<div class="math notranslate nohighlight">
\[
\theta_2 = 1+\frac{S_{II}}{S_I} \; .
\]</div>
</section>
<section id="implementation-of-node-based-ames">
<h2>Implementation of node-based AMEs<a class="headerlink" href="#implementation-of-node-based-ames" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numba</span><span class="w"> </span><span class="kn">import</span> <span class="n">jit</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">([</span><span class="s1">&#39;ggplot&#39;</span><span class="p">])</span>

<span class="c1"># We will use the odeint routine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">odeint</span>

<span class="c1">#Here, we will also use a global dictionary to keep track of states</span>
<span class="c1">#state_dict: keys are equation number and values are states (dictionary)</span>
<span class="k">global</span> <span class="n">d</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Master Equations</span>
<span class="k">def</span><span class="w"> </span><span class="nf">node_AME</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Time derivative of the occupation numbers.</span>

<span class="sd">        * x is the state distribution (array like)</span>
<span class="sd">        * t is time (scalar)</span>
<span class="sd">        * beta is the transmission rate (scalar)</span>
<span class="sd">        * alpha is the recovery rate (scalar)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#prepare data structure</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">x</span>

    <span class="c1">#calculate mean-field couplings</span>
    <span class="n">Ss</span><span class="p">,</span> <span class="n">Si</span><span class="p">,</span> <span class="n">Ssi</span><span class="p">,</span> <span class="n">Sii</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">eq_no</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">if</span> <span class="n">root</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
          <span class="n">Ss</span> <span class="o">+=</span> <span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span>
          <span class="n">Si</span> <span class="o">+=</span> <span class="n">l</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span>
          <span class="n">Ssi</span> <span class="o">+=</span> <span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span>
          <span class="n">Sii</span> <span class="o">+=</span> <span class="n">l</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">Ss</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">:</span>
      <span class="n">theta1</span> <span class="o">=</span> <span class="n">Ssi</span><span class="o">/</span><span class="n">Ss</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">theta1</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">Si</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">:</span>
      <span class="n">theta2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">Sii</span><span class="o">/</span><span class="n">Si</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">theta2</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1">#define equations</span>
    <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">eq_no</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="o">=</span> <span class="n">state</span>
      <span class="k">if</span> <span class="n">root</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1">#S_kl system</span>
        <span class="n">dx</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">d</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">)]]</span> <span class="o">-</span> <span class="n">beta</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="c1">#root node dynamics</span>
        <span class="n">dx</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="o">-=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta</span><span class="o">*</span><span class="n">theta1</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="c1">#leaf output</span>
        <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;</span><span class="n">k</span><span class="p">):</span> <span class="n">dx</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="o">+=</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">d</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)]]</span> <span class="c1">#leaf input</span>
        <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span> <span class="n">dx</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="o">+=</span> <span class="n">beta</span><span class="o">*</span><span class="n">theta1</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">d</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)]]</span> <span class="c1">#leaf input</span>
      <span class="k">elif</span> <span class="n">root</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="c1">#I_kl system</span>
        <span class="n">dx</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">d</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">)]]</span>  <span class="c1">#root node dynamics</span>
        <span class="n">dx</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="o">-=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">theta2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="c1">#leaf output</span>
        <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;</span><span class="n">k</span><span class="p">):</span> <span class="n">dx</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="o">+=</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">d</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)]]</span> <span class="c1">#leaf input</span>
        <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span> <span class="n">dx</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> <span class="o">+=</span> <span class="n">beta</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">theta2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">d</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)]]</span> <span class="c1">#leaf input</span>

    <span class="k">return</span> <span class="n">dx</span>

<span class="c1"># Time of observations</span>
<span class="n">t_length</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">t_steps</span> <span class="o">=</span> <span class="n">t_length</span><span class="o">+</span><span class="mi">1</span>
<span class="n">t_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_length</span><span class="p">,</span> <span class="n">t_steps</span><span class="p">)</span>

<span class="c1"># Parameters</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1">#parameter for geometric degree distribution</span>

<span class="c1"># Initial conditions: All nodes are infectious</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">x_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">kmax</span><span class="o">*</span><span class="p">(</span><span class="n">kmax</span><span class="o">+</span><span class="mi">1</span><span class="p">))))</span>
<span class="n">eq</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span> <span class="c1">#loop over root state</span>
  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmax</span><span class="p">):</span> <span class="c1">#loop over degree distribution</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="c1">#loop over neighbour states</span>
      <span class="n">d</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">eq</span>
      <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">l</span><span class="o">==</span><span class="n">k</span><span class="p">:</span>
        <span class="n">x_0</span><span class="p">[</span><span class="n">eq</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="n">k</span>
      <span class="n">eq</span> <span class="o">+=</span> <span class="mi">1</span>
  
<span class="c1"># Integration</span>
<span class="n">G</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">node_AME</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<span class="n">x_path</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">t_vec</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t_length</span><span class="p">):</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x_path</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
  <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">),</span> <span class="n">eq_no</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">root</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">I</span><span class="o">+=</span><span class="n">x</span><span class="p">[</span><span class="n">eq_no</span><span class="p">]</span> 
  <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">I</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prevalence&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
</pre></div>
</div>
<img alt="../_images/364c4a9535f84689c4a646ed1a148e10e8cf0c6323a2d3ba8093d38fcbf4a2ff.png" src="../_images/364c4a9535f84689c4a646ed1a148e10e8cf0c6323a2d3ba8093d38fcbf4a2ff.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lotka_volterra.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lotka-Volterra predator-prey model</p>
      </div>
    </a>
    <a class="right-next"
       href="meanFLAME.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Mean-field limits to approximate master equations</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ames-for-networks">AMEs for networks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logic-of-node-based-ames">Logic of node-based AMEs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-of-node-based-ames">Implementation of node-based AMEs</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Laurent Hébert-Dufresne, Guillaume St-Onge
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>